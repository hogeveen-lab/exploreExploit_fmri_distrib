#!/bin/bash
# """
# Explore-Exploit fMRI: Neuron Paper
# wb_command script to generate the pomdp surfmaps

# author: jeremy hogeveen (jhogeveen@unm.edu)
# last edit: March 9, 2022
# """

# setting up the filepaths
wbHomeDir=/Applications/workbench/bin_macosx64
cd $wbHomeDir
baseDir=PATHPATHPATHPATH # path to base directory
glasserDir=${baseDir}/rois/glasser
dlabelPath=${glasserDir}/HumanCorticalParcellations_wN_6V6gD/Q1-Q6_RelatedValidation210.CorticalAreas_dil_Final_Final_Areas_Group_Colors.32k_fs_LR.dlabel.nii
dscalarPath=${glasserDir}/HumanCorticalParcellations_wN_6V6gD/S1200.corrThickness_MSMAll.32k_fs_LR.dscalar.nii

# setting the pivotal input stats and output surfs paths
inPath=${baseDir}/rba_results
# inPath=/Users/jeremyhogeveen/Desktop/build_conjmap
outPath=${glasserDir}/surfs
# outPath=/Users/jeremyhogeveen/Desktop/build_conjmap/out
rm -rf ${outPath}/*

# Loading rba output files and creating surface maps FOR THE BONUS DATA
PplusTables=${inPath}/*Pplus_cortex.txt
# PplusTables=${inPath}/*.txt
for i in $PplusTables; do
	# pulling information from the filename -- next lines are temporary for conj map
	model=$(basename $i)
	model=`cut -d. -f1 <<< $model`
	outName=${outPath}/${model}
	# pulling information from the filename -- original version of code
	model=`cut -d_ -f9 <<< $i`
	model=${model#"se/"}
	con=`cut -d_ -f10 <<< $i`
	con=${con%"HCPMMP1"}
	outName=${model}_${con}	
	echo "#### GENERATING SURFACE PLOT SCALAR FOR ${outName} ####"
	./wb_command -cifti-parcellate $dscalarPath $dlabelPath 'COLUMN' ${outPath}/${outName}_tmp.pscalar.nii
	./wb_command -cifti-convert -from-text $i ${outPath}/${outName}_tmp.pscalar.nii ${outPath}/${outName}_final.pscalar.nii
done
