#!/bin/bash
# """
# Explore-Exploit fMRI: Neuron Paper
# FMRIprep has already normalized the data
# Therefore, we do not want the subject-level and group-level FSL models to re-normalize the data
# Step 1: Replace the func2standard.mat file with an identify matrix
# Step 2: Replace standard.nii.gz with the mean_func.nii.gz image

# author: jeremy hogeveen (jhogeveen@unm.edu)
# last edit: March 9, 2022
# """

# module load fsl # comment out if not running on Wheeler/HPC

# asking for what model the user wants to stop high level reg for
model_to_change=modelbased

# paths
basefolder=PATHPATHPATHPATH # filepath to base directory
fsl_base=${basefolder%%/}/fsl
fsl_scripts=${fsl_base%%/}/fsl_scripts 
cd $fsl_base

# Running Steps 1 and 2 in a Loop
counter=1
for s in sub-p*; do
	echo ${s}
	cd $s
	for r in *run*_${model_to_change}.feat; do
		# Step 1
		rm $r/reg/*.mat
		cp $fsl_scripts/flirtsch/ident.mat $r/reg/example_func2standard.mat
		cp $fsl_scripts/flirtsch/ident.mat $r/reg/standard2example_func.mat
		# Step 2
		cp $r/mean_func.nii.gz $r/reg/standard.nii.gz
		echo $counter
		counter=$((counter + 1))
	done
	cd $fsl_base
done






