#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Explore-Exploit fMRI: Neuron Paper
Filtering FMRIPREP confound regressor files to MP24
notes: Main code product is a *_filt.txt file for each run in the participant's fmriprep directory

author: jeremy hogeveen (jhogeveen@unm.edu)
last edit: March 3, 2021
"""

#%% Chunk 1: Importing packages and setting up the files we need
# Importing modules for the script
from glob import glob
import os.path as op
import pandas as pd

# setting up the filepaths
script_dir = op.dirname(__file__)
base_dir = op.abspath(op.join(script_dir,'..'))
confound_behave_filename = op.join(base_dir,'fmriprep/fmriprep/*/*/*bandit*desc-confounds_timeseries.tsv')

# getting the list of filenames we need to open in the series
confoundfiles = glob(confound_behave_filename)
#%%

#%% Chunk 2: Extracting MP24 as one potential correction
# Reading in the confounds file
for f in confoundfiles:
	# read in data
	tmp_df = pd.read_csv(f,sep='\t')
	# get the column names for translational and rotational motion timeseries
	motion_24 = [col for col in tmp_df if (col.startswith('trans_')) or (col.startswith('rot_'))]
	# filtering the data frame down to just the 24 motion regress columns
	df_confounds_filt = tmp_df[tmp_df.columns.intersection(motion_24)]
	# setting a new filepath to save the output
	out_filepath = f.replace('_timeseries.tsv', '_filt.txt')
	# saving the output
	df_confounds_filt.to_csv(out_filepath, index = False, header=False, sep='\t')
#%%