#!/usr/bin/env Rscript
# -*- coding: utf-8 -*-
# """
# Explore-Exploit fMRI: Neuron Manuscript
# Generating histograms of the rhats for the BMLM models

# author: jeremy hogeveen (jhogeveen@unm.edu)
# last edit: March 9, 2022
# """

#### #### #### #### ####
# Chunk #1: PREAMBLE #
#### #### #### #### ####
# * setting paths
# * loading R packages
# * creating some homemade plotting etc. functions

# clear env
if(!is.null(dev.list())) dev.off()
rm(list = ls())
cat("\014") 
options(buildtools.check = function(action) TRUE)

### Paths
# base filepath
basefolder <- '#####' # filepath to base directory
# input data for bandit task
rba_data <- paste(basefolder,'data_frames',sep='/')
rba_results <- paste(basefolder,'rba_results',sep='/')
# set up a potential output folder for saving plots
plotsfolder <- paste(basefolder,'rba_plots',sep = '/')

### Loading some functions
source(paste(basefolder,'bandit_functions.R',sep='/'))

### Reading in the packages I tend to use
source(paste(basefolder,'bandit_packages.R',sep='/'))
mylib()

### Setting some misc options
# Custom palette for plotting
my_palette <- c("#0000FF","#3ADF00","#FF0000","#ff7f00","#6a3d9a",
                "#a6cee3","#b2df8a","#fb9a99","#fdbf6f","#cab2d6",
                "#8dd3c7","#bebada","#d9d9d9","#fccde5","#ffffb3")
# Position dodging for interaction plots:
dodge <- position_dodge(1)
# For changing the default font sizes for all plots:
size<-11
theme_set(theme_grey(base_size = size))
# other miscellaneous stuff
select <- dplyr::select # to avoid lme4 overwriting select for dplyr
options(scipen = 999) # to provide precise decimal places rather than exponential notation

# loading the pacage needed for mcmc_rhat_hist
library(bayesplot)

#### #### #### #### ####
# Chunk #2: BRMS loading & rhat plotting #
#### #### #### #### ####
# loading in BRMS for each model discussed in the manuscript
# plotting the convergence

# Listing all maskave files
bmlm_files = list.files(rba_results, pattern='bonus.RData|iev.RData|trlsnov.RData|fev.RData|rpe.RData')


# Looping through maskave files
for(i in 1:length(bmlm_files)){
  contrast <- sub(".RData*", "", bmlm_files[i])
  curbmlm_RData <- paste(rba_results,bmlm_files[i],sep='/')
  load(curbmlm_RData)
  rhats <- rhat(run_brm)
  pdf(file=paste(plotsfolder,paste(contrast,'rhat_hist.pdf',sep="_"),sep='/'))
  plot(mcmc_rhat_hist(rhats))
  dev.off()
}